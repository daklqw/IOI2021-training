## Iceberg Orders

你在 $\texttt{Metagonia}$ 证券交易所工作。最近 $\texttt{Metagonia}$ 的商人们听说了 $\texttt{London}$ 证券交易所交易的 $\texttt{Iceberg}$ 订单，他们想让你的老板也加一个这样的功能。证券交易引擎是一个能接受订单并产生交易的引擎。

$\texttt{Iceberg}$ 订单是一个整数五元组 $(ID, T, P, V, TV)$，分别表示：

- 独一无二的标识符 $ID$
- 类型 $T$（取值在 $\{1, 2\}$ 中，$1$ 表示 $BUY$（买入），$2$ 表示 $sell$（卖出））
- 单价 $P$
- 总量 $V$
- 最高单次被交易量 $TV$

交易引擎还给每个订单追踪着额外的记录：

- 当前可交易量 $CV$
- 优先级 $PR$。

交易引擎全局还有一个优先级计数器 $GP$。

我们称订单表是由交易引擎中订单组成的集合。

交易引擎生成的交易是一个整数四元组 $(BUY\_ID, SELL\_ID, P, V)$。每个交易的 $BUY\_ID$ 和 $SELL\_ID$ 分别对应着 $BUY$ 和 $SELL$ 订单的标识符。$P$ 表示交易的单价，$V$ 表示交易量。

交易引擎收到一个订单后，会将它和订单表中其他订单进行匹配，具体地，会产生以下行为：

我们记收到的订单为 $a$，如果 $T_a$ 是 $SELL$，则需要：

- 重复以下过程直到总量 $V_a = 0$ 或中途退出：
  - 找到一个订单 $b$ 使得 $T_b$ 是 $BUY$ 并且 $P_B \geq P_a$。如果有多种选择，选择单价 $P$ 最大的。如果还有多种选择，选择优先级 $P$ 最小的。
  - 如果 $b$ 不存在，则退出这个过程。
  - 产生一个交易 $t = (BUY\_ID = ID_b, SELL\_ID = ID_a, P = P_b, V = \min(V_a, CV_b))$。
  - 将 $V_a, V_b, CV_b$ 都减少 $V_t$。
  - 如果总量 $V_b = 0$：
    - 将订单 $b$ 从订单表中删除。
  - 如果当前可交易量 $CV_b = 0 (V_b > 0)$：
    - 令当前可交易量 $CV_b = \min(V_b, TV_b)$。
    - 令优先级 $PR_b = GP$。
    - 增加优先级计数器 $GP$。
- 如果此时 $V_a$ 不是 $0$：
  - 令当前可交易量 $CV_a = \min(V_a, TV_a)$。
  - 令优先级 $PR_a = GP$。
  - 增加优先级计数器 $GP$。
  - 将订单 $a$ 加入订单表。
- 对于这次产生的交易，对于所有 $b$ 如果存在不止一个 $t$ 使得 $BUY\_ID_t = b$，那么：
  - 你需要将这些交易合并成单个交易 $t'$，并令 $V_{t'} = \sum_{BUY\_ID_t = b} V_t$。
  - 注意原来的那些多个交易 $t$ 将被抛弃，剩下的是交易 $t'$。

如果 $T_a$ 是 $BUY$：

过程和之前描述的（$T_a$ 是 $SELL$） 情况类似，只是在选择交易 $b$ 和产生的交易上有所不同：

- 找到一个订单 $b$ 使得 $T_b$ 是 $SELL$，并且 $P_b \leq P_a$。如果有多种选择，选择单价 $P$ 最小的。如果还有多种选择，选择优先级 $PR$ 最小的。
- 产生的交易是 $t = (BUY\_ID = ID_a, SELL\_ID = ID_b, P = P_b, V = \min(V_a, CV_b))$。

一开始订单表是空的。你会按顺序收到交易所得到的数个订单。你需要输出生成的交易以及在所有订单完成后剩下的订单表。

**提示：** 题面里的优先级 $PR$ 以及优先级计数器 $GP$ 只是用来描述交易引擎的算法的。实际上你的实现没有完全必要去记录优先级 $PR$，通常只会在价钱相同的订单之间保留一个相对顺序表。


